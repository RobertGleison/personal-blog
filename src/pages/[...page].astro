---
import BaseLayout from '../layouts/BaseLayout.astro';
import ArticleCard from '../components/ArticleCard.astro';
import SearchBar from '../components/SearchBar.astro';
import Pagination from '../components/Pagination.astro';

export async function getStaticPaths({ paginate }: any) {
  const allPosts = await Astro.glob('./posts/*.md');

  const sortedPosts = allPosts
    .filter(post => post.frontmatter?.pubDate)
    .sort((a, b) => {
      return new Date(b.frontmatter.pubDate).getTime() - new Date(a.frontmatter.pubDate).getTime();
    });

  return paginate(sortedPosts, { pageSize: 9 });
}

const { page } = Astro.props;
---

<BaseLayout title={`Page ${page.currentPage} - My Blog`} description="Read the latest articles on my blog">
  <div class="home-container">
    <div class="home-header">
      <h1>Latest Articles</h1>
      <SearchBar />
    </div>

    <div class="articles-grid">
      {page.data.map((post: any) => (
        <ArticleCard
          url={post.url || ''}
          title={post.frontmatter.title}
          description={post.frontmatter.description}
          pubDate={new Date(post.frontmatter.pubDate)}
          author={post.frontmatter.author}
          image={post.frontmatter.image}
          tags={post.frontmatter.tags}
        />
      ))}
    </div>

    <Pagination
      currentPage={page.currentPage}
      totalPages={page.lastPage}
      baseUrl="/"
    />
  </div>
</BaseLayout>
