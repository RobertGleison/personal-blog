---
interface Props {
  currentPage: number;
  totalPages: number;
  baseUrl?: string;
}

const { currentPage, totalPages, baseUrl = '/' } = Astro.props;

const getPageUrl = (page: number) => {
  // Remove trailing slash from baseUrl if present
  const cleanBaseUrl = baseUrl.endsWith('/') ? baseUrl.slice(0, -1) : baseUrl;

  if (page === 1) {
    // For page 1, return baseUrl as-is (with trailing slash if it had one)
    return baseUrl;
  }

  // For other pages, append the page number
  return `${cleanBaseUrl}/${page}/`;
};

const pages = Array.from({ length: totalPages }, (_, i) => i + 1);
const showPages = pages.filter(page => {
  if (page === 1 || page === totalPages) return true;
  if (page >= currentPage - 1 && page <= currentPage + 1) return true;
  return false;
});
---

{totalPages > 1 && (
  <nav class="pagination" aria-label="Pagination">
    {currentPage > 1 && (
      <a href={getPageUrl(currentPage - 1)} class="pagination-link" aria-label="Previous page">
        &laquo; Prev
      </a>
    )}

    {showPages.map((page, index) => {
      const prevPage = showPages[index - 1];
      const showEllipsis = prevPage && page - prevPage > 1;

      return (
        <>
          {showEllipsis && <span class="pagination-ellipsis">...</span>}
          <a
            href={getPageUrl(page)}
            class={`pagination-link ${page === currentPage ? 'active' : ''}`}
            aria-label={`Page ${page}`}
            aria-current={page === currentPage ? 'page' : undefined}
          >
            {page}
          </a>
        </>
      );
    })}

    {currentPage < totalPages && (
      <a href={getPageUrl(currentPage + 1)} class="pagination-link" aria-label="Next page">
        Next &raquo;
      </a>
    )}
  </nav>
)}

<style>
  /* Pagination */
  .pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 0.5rem;
    margin-top: 3rem;
  }

  .pagination-link {
    padding: 0.5rem 1rem;
    border: 1px solid var(--border-color);
    border-radius: 6px;
    text-decoration: none;
    color: var(--text-muted);
    background: var(--bg-secondary);
    transition: all 0.2s, background-color 0.3s ease;
  }

  .pagination-link:hover {
    background: var(--bg-quaternary);
    border-color: var(--accent-color);
    color: var(--accent-color);
  }

  .pagination-link.active {
    background: var(--accent-color);
    color: var(--accent-contrast);
    border-color: var(--accent-color);
  }

  .pagination-ellipsis {
    padding: 0.5rem;
    color: var(--text-muted);
    transition: color 0.3s ease;
  }
</style>
